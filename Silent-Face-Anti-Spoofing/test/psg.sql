CREATE EXTENSION IF NOT EXISTS vector;

CREATE TABLE face_embeddings (
    id SERIAL PRIMARY KEY,
    student_id TEXT NOT NULL,
    embedding vector(128)
);

SELECT * FROM face_embeddings;

CREATE INDEX face_embedding_ann_idx ON face_embeddings USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);

ANALYZE face_embeddings;
























CREATE EXTENSION IF NOT EXISTS vector;

CREATE TABLE face_embeddings (
    id SERIAL PRIMARY KEY,
    student_id TEXT NOT NULL,
    embedding vector(128)
);

SELECT * FROM face_embeddings LIMIT 1000;

DELETE FROM face_embeddings WHERE id = 92;


DROP TABLE face_embeddings;


CREATE INDEX face_embedding_ann_idx ON face_embeddings USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);

ANALYZE face_embeddings;

EXPLAIN ANALYZE
SELECT student_id, embedding <-> '[-0.042198762,0.045063637,0.0525911,-0.074435115,-0.11102648,-0.039779335,-0.08258113,-0.10606569,0.10987646,-0.1435165,0.23144084,-0.08606559,-0.19333628,-0.058152534,-0.06936922,0.20691763,-0.11363688,-0.1205743,-0.025774833,0.0061291046,0.054690015,0.030999178,0.0026207943,0.029429983,-0.068072885,-0.34441745,-0.07616085,-0.0060548913,-0.05510052,-0.0035406004,-0.051591486,0.106518194,-0.1499492,-0.027023224,0.10098969,0.105149746,0.00038077997,-0.091807336,0.174199,0.016461603,-0.25821665,0.03619987,0.13091142,0.24035794,0.14840795,0.03412005,0.010695088,-0.16114211,0.17449357,-0.19155785,0.007945216,0.11599285,0.089629605,-0.010664508,0.049498625,-0.10958272,0.0299614,0.14101349,-0.15324165,-0.01744006,0.052271254,-0.015829008,-0.028835332,-0.15766913,0.23970732,0.086235814,-0.13625139,-0.15877865,0.1646586,-0.10962411,-0.090082966,0.07485775,-0.1482215,-0.20341156,-0.25493413,-0.0066247424,0.37873715,0.11552955,-0.19216499,0.056143463,-0.012366983,-0.019680295,0.110504836,0.14615732,0.01284592,0.02230608,-0.061771408,-0.04767139,0.30560416,-0.071254686,-0.025920363,0.22382715,0.0080336165,0.05827302,-0.0055747633,-0.010553275,-0.08116853,0.0319635,-0.2335381,-0.05685733,-0.0063313246,-0.033369675,-0.02032668,0.12878092,-0.21549223,0.088794775,-0.0072854753,-0.012105874,0.03654309,0.00971988,-0.091328435,-0.05865436,0.10331749,-0.21633287,0.14540507,0.13129464,0.13882804,0.1088396,0.14565974,0.0494579,0.04814927,-0.06005956,-0.18953118,-0.070532,0.11208644,-0.042840213,0.06992416,-0.008723214]'::vector AS distance
FROM face_embeddings
ORDER BY embedding <-> '[-0.042198762,0.045063637,0.0525911,-0.074435115,-0.11102648,-0.039779335,-0.08258113,-0.10606569,0.10987646,-0.1435165,0.23144084,-0.08606559,-0.19333628,-0.058152534,-0.06936922,0.20691763,-0.11363688,-0.1205743,-0.025774833,0.0061291046,0.054690015,0.030999178,0.0026207943,0.029429983,-0.068072885,-0.34441745,-0.07616085,-0.0060548913,-0.05510052,-0.0035406004,-0.051591486,0.106518194,-0.1499492,-0.027023224,0.10098969,0.105149746,0.00038077997,-0.091807336,0.174199,0.016461603,-0.25821665,0.03619987,0.13091142,0.24035794,0.14840795,0.03412005,0.010695088,-0.16114211,0.17449357,-0.19155785,0.007945216,0.11599285,0.089629605,-0.010664508,0.049498625,-0.10958272,0.0299614,0.14101349,-0.15324165,-0.01744006,0.052271254,-0.015829008,-0.028835332,-0.15766913,0.23970732,0.086235814,-0.13625139,-0.15877865,0.1646586,-0.10962411,-0.090082966,0.07485775,-0.1482215,-0.20341156,-0.25493413,-0.0066247424,0.37873715,0.11552955,-0.19216499,0.056143463,-0.012366983,-0.019680295,0.110504836,0.14615732,0.01284592,0.02230608,-0.061771408,-0.04767139,0.30560416,-0.071254686,-0.025920363,0.22382715,0.0080336165,0.05827302,-0.0055747633,-0.010553275,-0.08116853,0.0319635,-0.2335381,-0.05685733,-0.0063313246,-0.033369675,-0.02032668,0.12878092,-0.21549223,0.088794775,-0.0072854753,-0.012105874,0.03654309,0.00971988,-0.091328435,-0.05865436,0.10331749,-0.21633287,0.14540507,0.13129464,0.13882804,0.1088396,0.14565974,0.0494579,0.04814927,-0.06005956,-0.18953118,-0.070532,0.11208644,-0.042840213,0.06992416,-0.008723214]'::vector
LIMIT 5;

SELECT * FROM pg_indexes WHERE tablename = 'face_embeddings';



